# Система управления гостиничными номерами и их бронированием

Данный проект представляет собой серверную часть системы управления номерами гостиницы и их бронированием. Проект разработан на Java с использованием Spring Boot и шаблонизатора Thymeleaf. Система построена по паттерну проектирования MVC и предоставляет функционал как для клиентов, так и для администраторов с ролевой моделью доступа, реализованной через Spring Security.

---

## Основные возможности

### Общие функции
- **Ролевая модель доступа**:
  - **Администратор**: Полный контроль над номерами, пользователями и бронированиями.
  - **Клиент**: Управление личными бронированиями и данными профиля.
  - **Неавторизованный пользователь**: Возможность регистрации или входа в систему.
- **Аутентификация и авторизация пользователей**:
  - Регистрация и вход в систему.
  - Spring Security для аутентификации и управления ролями.
  - Шифрование паролей с использованием алгоритма Bcrypt.
- **Валидация полей**:
  - Аннотации Hibernate Validator для базовой проверки полей.
  - Кастомные валидаторы:
    - Проверка уникальности электронной почты и телефона.
    - Проверка доступности номеров для бронирования в реальном времени.
- **Защита от CSRF-атак** включена по умолчанию.

### Функционал для клиентов
- Бронирование номеров:
  - Создание и редактирование своих бронирований.
- Просмотр информации:
  - Просмотр данных о номерах, своем профиле и своих бронированиях.
- Управление личной информацией:
  - Обновление данных профиля, включая смену пароля.

### Функционал для администратора
- Управление гостиничными номерами:
  - Просмотр, создание, редактирование и удаление номеров.
- Управление пользователями:
  - Просмотр, создание, редактирование (кроме паролей юзеров) и удаление пользователей.
- Управление бронированиями:
  - Просмотр, создание, редактирование и удаление всех бронирований (как клиентов, так и администраторов).

### Технологии
- **Язык программирования**: Java
- **Фреймворк**: Spring Boot
- **База данных**: PostgreSQL
- **ORM**: Hibernate
- **Frontend**: Thymeleaf, HTML5, CSS3
- **Сборщик**: Maven
- **Паттерн проектирования**: MVC (Model-View-Controller)

---

## Установка и запуск

### Требования
- JDK 17 или выше
- Maven 3.8+
- PostgreSQL 14+
- Git

### Шаги
1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/TusyaSonne/HotelBackend.git
   ```
2. Настройте базу данных:
   - Создайте БД PostgreSQL:
   ```sql
   CREATE DATABASE hotel_db;
   
   CREATE TABLE Person(
    id int PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    full_name varchar(100) NOT NULL,
    password varchar NOT NULL,
    email varchar(100) NOT NULL UNIQUE,
    phone varchar(12) NOT NULL UNIQUE,
    role varchar(50) NOT NULL
   );

   CREATE TABLE Room(
    id int PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    capacity int NOT NULL,
    price_per_night float NOT NULL
   );

   CREATE TABLE Reservation(
     id int PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
     total_price float NOT NULL,
     check_in DATE NOT NULL,
     check_out DATE NOT NULL,
     person_id int NOT NULL REFERENCES Person(id) ON DELETE CASCADE,
     room_id int NOT NULL REFERENCES Room(id) ON DELETE CASCADE
   );

    -- Функция для расчета total_price
    CREATE OR REPLACE FUNCTION calculate_total_price()
        RETURNS TRIGGER AS $$
    DECLARE
        nights int;
        room_price float;
    BEGIN
        -- Определяем количество ночей между check_in и check_out
        nights := (NEW.check_out - NEW.check_in);
    
        -- Получаем цену за одну ночь из таблицы Room для соответствующего room_id
        SELECT r.price_per_night INTO room_price
        FROM Room AS r
        WHERE r.id = NEW.room_id;
    
        -- Рассчитываем общую стоимость
        NEW.total_price := room_price * nights;
    
        RETURN NEW;
    END;
    $$ LANGUAGE plpgsql;

    INSERT INTO Person(full_name, password, email, phone, role) VALUES ('Дженбаз Артур Ринатович', '$2a$10$VWZ3wVasGQHGErfkZYolL.Mp3RROEVw7DkVUSdYEsDK7yRMU1hvz2', 'artur.dzhenbaz@gmail.com', '+78005553545', 'ROLE_ADMIN');
   ```
3. Обновите файл **application.properties** вашими данными:
  ```bash
   # (Data source)
    spring.datasource.driver-class-name=org.postgresql.Driver
    spring.datasource.url=jdbc:postgresql://localhost:5432/hotel_db
    spring.datasource.username=ВАШ_ЮЗЕРНЕЙМ
    spring.datasource.password=ВАШ_ПАРОЛЬ
   ```
4. Запустите проект через вашу IDE (при разработке проекта использовалась IntelliJ IDEA 2024.1.4 Ultimate Edition).
5. Перейдите по адресу **http://localhost:8080**
Вы попадете на страницу авторизации.
- Для прав клиента можете зарегистрироваться.
- Для прав администратора воспользуйтесь следующими данными для входа:
  - Почта: **artur.dzhenbaz@gmail.com**
  - Пароль: **1234**
